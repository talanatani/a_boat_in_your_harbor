<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="BLANKET ME" />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#000;
      --stageMax: 1200px;
      --stagePad: 40px;

      --portalPages: 2.6;
      --ceremonyPages: 7.4; /* ✅ more scroll / more breath */

      /* reveal controls */
      --mistOpacityMax: 0.55;
      --rainOpacityMax: 0.62;

      /* text */
      --textSize: clamp(16px, 1.6vw, 22px);
    }

    *{ box-sizing:border-box; }
    html, body{ height:100%; margin:0; }
    body{
      background: var(--bg);
      overflow-x:hidden;
      font-family: "Inter", system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      color:#fff;
      position:relative;
    }

    /* =========================
       ICHOR / MIST + OCEAN (hidden until ceremony)
       ========================= */
    .mist{
      position: fixed;
      inset: -20%;
      z-index: 0;
      pointer-events: none;
      opacity: 0;                /* ✅ hidden on portal */
      filter: blur(26px);

      background:
        radial-gradient(1400px 1200px at 50% 35%, rgba(210,225,255,.16), rgba(0,0,0,0) 68%),
        radial-gradient(1600px 1400px at 50% 80%, rgba(120,150,210,.12), rgba(0,0,0,0) 72%),
        radial-gradient(900px 900px at 15% 55%, rgba(180,190,215,.07), rgba(0,0,0,0) 70%),
        radial-gradient(900px 900px at 85% 45%, rgba(160,180,210,.06), rgba(0,0,0,0) 70%);

      animation: mistDrift 26s ease-in-out infinite alternate;
      transform: translate3d(0,0,0);
      transition: opacity 1200ms ease;
      will-change: opacity;
    }
    @keyframes mistDrift{
      0%   { transform: translate3d(-1.2%, -0.8%, 0) scale(1.03); }
      100% { transform: translate3d( 1.2%,  0.8%, 0) scale(1.07); }
    }

    canvas#ocean{
      position: fixed;
      inset: 0;
      z-index: 0;
      pointer-events: none;
      opacity: 0;                /* ✅ hidden on portal */
      filter: blur(0.25px);
      transition: opacity 1200ms ease;
    }

    /* subtle vignette */
    body::after{
      content:"";
      position: fixed;
      inset: 0;
      z-index: 0;
      pointer-events:none;
      background: radial-gradient(120% 90% at 50% 40%, rgba(0,0,0,0) 52%, rgba(0,0,0,.70) 100%);
      opacity: .65;
    }

    /* =========================
       PORTAL
       ========================= */
    .portal{
      position: relative;
      height: calc(var(--portalPages) * 100vh);
      z-index: 1;
    }
    .portal-stage{
      position: sticky;
      top:0;
      height:100vh;
      display:grid;
      place-items: start center;
      overflow:hidden;
    }
    .portal-inner{
      width: min(var(--stageMax), calc(100vw - var(--stagePad)));
      height:100%;
      position:relative;
      overflow:hidden;
    }
    .portal-inner img{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
      object-fit: contain;
      object-position: top center;
      transform: translate3d(0, var(--y, 0px), 0) scale(1.55);
      transform-origin: top center;
      will-change: transform;
      display:block;
      z-index:1;
    }
    .portal-inner::after{
      content:"";
      position:absolute;
      inset:0;
      pointer-events:none;
      background: radial-gradient(120% 85% at 50% 55%, rgba(0,0,0,0) 55%, rgba(0,0,0,.55) 100%);
      z-index:2;
    }

    /* BLANKET ME — FIXED FOR MOBILE */
    .invocation{
      position:absolute;
      left:50%;
      top:18%;
      transform: translate(-50%,-50%);
      z-index:3;

      width: max-content;
      max-width: none;
      white-space: nowrap;
      word-break: keep-all;
      overflow: visible;

      font-weight: 500;
      text-transform: uppercase;

      font-size: clamp(22px, 6.2vw, 56px);
      letter-spacing: clamp(.14em, 2.2vw, .26em);

      text-align:center;
      line-height:1;

      color: rgba(255,255,255,.18);
      text-shadow:
        0 0 6px rgba(255,255,255,.32),
        0 0 18px rgba(255,255,255,.20);

      opacity: var(--invOpacity, 1);
      transition: opacity 2.8s ease;
      will-change: opacity;
    }

    /* =========================
       CEREMONY — SCROLL STAGE
       ========================= */
    .ceremony{
      position: relative;
      height: calc(var(--ceremonyPages) * 100vh);
      z-index: 1;
    }
    .ceremony-stage{
      position: sticky;
      top:0;
      height:100vh;
      display:grid;
      place-items:center;
      overflow:hidden;
    }
    .ceremony-inner{
      width: min(var(--stageMax), calc(100vw - var(--stagePad)));
      height:100%;
      position:relative;
      display:grid;
      place-items:center;
    }

    /* LINE STATIONS (vertical descent positions) */
    .line{
      position:absolute;
      left:50%;
      transform: translateX(-50%);
      text-align:center;

      font-size: var(--textSize);
      line-height: 1.24;
      letter-spacing: .01em;
      font-weight: 400;

      /* default: allow normal wrap on small screens */
      white-space: normal;
      max-width: 92vw;

      color: rgba(255,255,255,.90);
      text-shadow:
        0 0 2px rgba(255,255,255,.22),
        0 0 14px rgba(200,220,255,.12),
        0 0 26px rgba(180,200,255,.05);

      opacity: 0;
      filter: blur(1.2px);
      transition: opacity 320ms linear, filter 420ms linear;
      will-change: opacity, filter;
      pointer-events:none;
    }

    /* force first line to be 1 line; we'll auto-fit via JS */
    #l1{
      white-space: nowrap;
      max-width: none;
      transform-origin: center;
    }

    /* vertical stations */
    .s1{ top: 18%; }
    .s2{ top: 34%; }
    .s3{ top: 54%; }
    .s4{ top: 70%; }

    /* ENTER — in the bottom black space */
    .enter{
      position:absolute;
      left:50%;
      bottom: 9vh;          /* ✅ moved into lower void */
      top:auto;
      transform: translateX(-50%);

      padding: 14px 30px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.22);
      background: rgba(255,255,255,.03);
      backdrop-filter: blur(7px);

      font-size: 14px;
      letter-spacing: .18em;
      text-transform: lowercase;
      font-weight: 400;

      color: rgba(255,255,255,.85);
      text-shadow:
        0 0 10px rgba(220,235,255,.18),
        0 0 26px rgba(200,220,255,.14);

      box-shadow:
        0 0 18px rgba(200,220,255,.10),
        inset 0 0 16px rgba(255,255,255,.05);

      opacity: 0;
      filter: blur(.8px);
      transition: opacity 500ms linear, filter 800ms ease, transform 800ms ease;
      cursor: pointer;
      user-select:none;
      z-index: 4;
    }
    .enter:hover{
      opacity: 1;
      filter: blur(0px);
      transform: translateX(-50%) scale(1.01);
      border-color: rgba(255,255,255,.35);
      box-shadow:
        0 0 24px rgba(200,220,255,.14),
        inset 0 0 18px rgba(255,255,255,.06);
    }
  </style>
</head>

<body>
  <div class="mist" id="mist" aria-hidden="true"></div>
  <canvas id="ocean" aria-hidden="true"></canvas>

  <!-- PORTAL -->
  <section class="portal" id="portal">
    <div class="portal-stage">
      <div class="portal-inner">
        <img id="hero" src="new_portal.jpeg" alt="">
        <div class="invocation" id="invocation">BLANKET ME</div>
      </div>
    </div>
  </section>

  <!-- CEREMONY -->
  <section class="ceremony" id="ceremony">
    <div class="ceremony-stage">
      <div class="ceremony-inner">

        <div class="line s1" id="l1">we imagine in this exhibition an invitation to witness our creation of new ways of experiencing boundless love</div>
        <div class="line s2" id="l2">forward-facing and fusing ethereality with inspiration</div>
        <div class="line s3" id="l3">we bear witness and release limitation</div>
        <div class="line s4" id="l4">opening to transformation</div>

        <button class="enter" id="enter" type="button">enter</button>

      </div>
    </div>
  </section>

  <!-- NEXT CHAMBER ANCHOR (hook) -->
  <section id="next" style="height:120vh; background:#000; position:relative; z-index:1;"></section>

  <script>
    /* =========================================================
       OCEAN RAIN / ASH (more enveloping, less streaky)
       ========================================================= */
    const ocean = document.getElementById("ocean");
    const ctx = ocean.getContext("2d", { alpha: true });
    const mistEl = document.getElementById("mist");

    let W=0, H=0, DPR=1;
    let drops = [];
    let raf = null;

    function resizeOcean(){
      DPR = Math.min(2, window.devicePixelRatio || 1);
      W = window.innerWidth;
      H = window.innerHeight;

      ocean.width = Math.floor(W * DPR);
      ocean.height = Math.floor(H * DPR);
      ocean.style.width = W + "px";
      ocean.style.height = H + "px";

      ctx.setTransform(DPR,0,0,DPR,0,0);

      const n = Math.max(160, Math.min(420, Math.floor((W*H)/13000)));
      drops = Array.from({length:n}, () => newDrop(true));
    }

    function newDrop(randomY){
      const misty = Math.random() < 0.70; // ✅ more vapor, less rain-cue
      return {
        x: Math.random() * W,
        y: randomY ? Math.random() * H : (-200 - Math.random()*H),
        len: misty ? (110 + Math.random()*260) : (70 + Math.random()*190),
        spd: misty ? (0.25 + Math.random()*0.60) : (0.45 + Math.random()*0.90), // ✅ slower = oceanic
        w:   misty ? (1.4 + Math.random()*2.6) : (0.9 + Math.random()*2.0),
        a:   misty ? (0.014 + Math.random()*0.045) : (0.022 + Math.random()*0.065),
        sway:(-0.18 + Math.random()*0.36)
      };
    }

    function drawOcean(rainBoost=1){
      ctx.clearRect(0,0,W,H);
      ctx.globalCompositeOperation = "lighter";

      for (const d of drops){
        d.y += d.spd * rainBoost;
        d.x += d.sway * 0.18;

        if (d.y - d.len > H){
          d.y = -d.len - 40 - Math.random()*180;
          d.x = Math.random() * W;
        }
        if (d.x < -60) d.x = W + 60;
        if (d.x > W + 60) d.x = -60;

        const g = ctx.createLinearGradient(d.x, d.y, d.x, d.y + d.len);
        g.addColorStop(0,   `rgba(255,255,255,0)`);
        g.addColorStop(0.35,`rgba(220,235,255,${d.a})`);
        g.addColorStop(1,   `rgba(255,255,255,0)`);

        ctx.strokeStyle = g;
        ctx.lineWidth = d.w;
        ctx.lineCap = "round";

        ctx.beginPath();
        ctx.moveTo(d.x, d.y);
        ctx.lineTo(d.x + d.sway*6, d.y + d.len);
        ctx.stroke();
      }

      ctx.globalCompositeOperation = "source-over";
    }

    function loop(){
      drawOcean(window.__rainBoost || 1);
      raf = requestAnimationFrame(loop);
    }

    resizeOcean();
    loop();
    window.addEventListener("resize", () => {
      resizeOcean();
      fitLine1(); // keep first line single-line after resize/rotation
    });

    /* =========================================================
       PORTAL DRIFT + BLANKET ME FADE
       ========================================================= */
    const hero = document.getElementById("hero");
    const portal = document.getElementById("portal");
    const invocation = document.getElementById("invocation");

    function portalScroll(){
      const rect = portal.getBoundingClientRect();
      const vh = window.innerHeight;
      const total = rect.height - vh;
      const p = Math.min(1, Math.max(0, (-rect.top) / (total || 1)));

      const driftPx = vh * 0.28;
      const y = (0.5 - p) * 2 * driftPx;
      hero.style.setProperty("--y", `${y}px`);

      const fadeEnd = 0.78;
      const t = Math.min(1, p / fadeEnd);
      invocation.style.setProperty("--invOpacity", (1 - t).toFixed(3));
    }

    /* =========================================================
       CEREMONY: ONE LINE AT A TIME, VERTICAL DESCENT
       ========================================================= */
    const ceremony = document.getElementById("ceremony");
    const lines = [
      document.getElementById("l1"),
      document.getElementById("l2"),
      document.getElementById("l3"),
      document.getElementById("l4"),
    ];
    const enter = document.getElementById("enter");

    function smoothstep(x){
      x = Math.min(1, Math.max(0, x));
      return x*x*(3 - 2*x);
    }

    // ✅ keep first line as ONE line by scaling down if needed (mobile-safe)
    function fitLine1(){
      const el = lines[0];
      if (!el) return;

      // reset
      el.style.transform = "translateX(-50%) scale(1)";
      const vw = Math.min(window.innerWidth * 0.92, 1200);

      // if it overflows, scale down to fit
      const w = el.scrollWidth;
      if (w > vw){
        const s = Math.max(0.72, Math.min(1, vw / w));
        el.style.transform = `translateX(-50%) scale(${s.toFixed(3)})`;
      }
    }

    function ceremonyScroll(){
      const rect = ceremony.getBoundingClientRect();
      const vh = window.innerHeight;
      const total = rect.height - vh;
      const p = Math.min(1, Math.max(0, (-rect.top) / (total || 1)));

      // ✅ transition feels inevitable: later onset + longer ramp
      const rainIn = smoothstep((p - 0.12) / 0.42);

      // reveal mist + ocean only in ceremony (no portal rain)
      const mistMax = parseFloat(getComputedStyle(document.documentElement).getPropertyValue("--mistOpacityMax")) || 0.55;
      mistEl.style.opacity = (rainIn * mistMax).toFixed(3);

      const rainMax = parseFloat(getComputedStyle(document.documentElement).getPropertyValue("--rainOpacityMax")) || 0.62;
      ocean.style.opacity = (rainIn * rainMax).toFixed(3);

      // ocean speed: heavier as you enter
      window.__rainBoost = 0.85 + rainIn * 1.25;

      // LINE SEQUENCING: plenty of space between lines
      const n = lines.length;

      // longer ceremony -> keep segments roomy; this leaves end room for "enter"
      const seg = 1 / (n + 1.35);

      // fade window within each segment (in early, out before next begins)
      const inStart = 0.16;
      const outStart = 0.56;

      for (let i=0; i<n; i++){
        const start = i * seg;
        const local = (p - start) / (seg || 1);

        let alpha = 0;

        // fade in
        if (local >= inStart && local <= outStart){
          const tIn = (local - inStart) / (outStart - inStart);
          alpha = smoothstep(tIn);
        }
        // fade out (before next starts)
        if (local > outStart){
          const tOut = (local - outStart) / (1 - outStart);
          alpha = 1 - smoothstep(tOut);
        }

        alpha = Math.max(0, Math.min(1, alpha));
        lines[i].style.opacity = alpha.toFixed(3);
        lines[i].style.filter = `blur(${(1.2 * (1 - alpha)).toFixed(2)}px)`;
      }

      // ✅ ritual breath before enter appears
      const enterStart = (n * seg) + 0.08;
      const enterAlpha = smoothstep((p - enterStart) / 0.18);
      enter.style.opacity = enterAlpha.toFixed(3);
      enter.style.filter = `blur(${(0.8 * (1 - enterAlpha)).toFixed(2)}px)`;

      // keep line 1 as one-line at all times
      if (enterAlpha < 0.98) fitLine1();
    }

    function onScroll(){
      portalScroll();
      ceremonyScroll();
    }

    window.addEventListener("scroll", onScroll, { passive:true });
    window.addEventListener("load", () => {
      fitLine1();
      onScroll();
    });
    onScroll();

    /* ENTER BUTTON ACTION */
    enter.addEventListener("click", () => {
      const next = document.getElementById("next");
      if (next) next.scrollIntoView({ behavior: "smooth", block: "start" });
      // Replace with window.location.href = "next.html" if you want page navigation.
    });
  </script>
</body>
</html>
