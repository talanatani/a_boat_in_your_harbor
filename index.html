<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="description" content="BLANKET ME" />

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500&display=swap" rel="stylesheet">

<style>
:root{
--bg:#000;
--stageMax: 1200px;
--stagePad: 40px;

--portalPages: 2.6;
--ceremonyPages: 7.4;

--mistOpacityMax: 0.55;
--rainOpacityMax: 0.50;

--textSize: clamp(16px, 1.6vw, 22px);

/* iOS-safe viewport unit: set by JS */
--vh: 1vh;
}

*{ box-sizing:border-box; }
html, body{ height:100%; margin:0; }
html, body{
-webkit-text-size-adjust: 100%;
text-size-adjust: 100%;
}
body{
background: var(--bg);
overflow-x:hidden;
font-family: "Inter", system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
color:#fff;
position:relative;
touch-action: pan-y;
}

    /* remove bullets everywhere (future-proof) */
    ul, ol{ list-style:none; padding:0; margin:0; }
    li{ list-style:none; }
    /* NO BULLETS (future-proof) */
    ul, ol{ list-style:none !important; padding:0; margin:0; }
    li{ list-style:none !important; }

.mist{
position: fixed;
@@ -55,4 +55,561 @@
filter: blur(26px);
background:
radial-gradient(1400px 1200px at 50% 35%, rgba(210,225,255,.14), rgba(0,0,0,0) 68%),
        radial-gradient(1600px 1400px at 50% 80%,
        radial-gradient(1600px 1400px at 50% 80%, rgba(120,150,210,.10), rgba(0,0,0,0) 72%),
        radial-gradient(900px 900px at 15% 55%, rgba(180,190,215,.06), rgba(0,0,0,0) 70%),
        radial-gradient(900px 900px at 85% 45%, rgba(160,180,210,.05), rgba(0,0,0,0) 70%);
      animation: mistDrift 26s ease-in-out infinite alternate;
      transform: translate3d(0,0,0);
      will-change: opacity, transform;
    }
    @keyframes mistDrift{
      0%   { transform: translate3d(-1.2%, -0.8%, 0) scale(1.03); }
      100% { transform: translate3d( 1.2%,  0.8%, 0) scale(1.07); }
    }

    canvas#ocean{
      position: fixed;
      inset: 0;
      z-index: 0;
      pointer-events: none;
      opacity: 0;
      filter: blur(0px);
      will-change: opacity;
    }

    body::after{
      content:"";
      position: fixed;
      inset: 0;
      z-index: 0;
      pointer-events:none;
      background: radial-gradient(120% 90% at 50% 40%, rgba(0,0,0,0) 52%, rgba(0,0,0,.70) 100%);
      opacity: .65;
    }

    /* Use --vh everywhere (prevents iOS scroll wobble) */
    .portal{
      position: relative;
      height: calc(var(--portalPages) * (var(--vh) * 100));
      z-index: 1;
    }
    .portal-stage{
      position: sticky;
      top:0;
      height: calc(var(--vh) * 100);
      display:grid;
      place-items: start center;
      overflow:hidden;
    }
    .portal-inner{
      width: min(var(--stageMax), calc(100vw - var(--stagePad)));
      height:100%;
      position:relative;
      overflow:hidden;
    }
    .portal-inner img{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
      object-fit: contain;
      object-position: top center;
      transform: translate3d(0, var(--y, 0px), 0) scale(1.55);
      transform-origin: top center;
      will-change: transform;
      display:block;
      z-index:1;
    }
    .portal-inner::after{
      content:"";
      position:absolute;
      inset:0;
      pointer-events:none;
      background: radial-gradient(120% 85% at 50% 55%, rgba(0,0,0,0) 55%, rgba(0,0,0,.55) 100%);
      z-index:2;
    }

    /* TICKER: centered vertically, full opacity */
    .invocation{
      position:absolute;
      left:50%;
      top:50%;
      transform: translate(-50%,-50%);
      z-index:3;

      width: max-content;
      max-width: none;
      white-space: nowrap;
      word-break: keep-all;

      font-weight: 500;
      text-transform: uppercase;

      font-size: clamp(22px, 6.2vw, 56px);
      letter-spacing: clamp(.14em, 2.2vw, .26em);

      text-align:center;
      line-height:1;

      color: rgba(255,255,255,1); /* 1.00 */
      opacity: 1;                 /* 1.00 */

      text-shadow:
        0 0 6px rgba(255,255,255,.32),
        0 0 18px rgba(255,255,255,.20);

      transition: none;
      will-change: transform;
      pointer-events: none;
    }

    .ceremony{
      position: relative;
      height: calc(var(--ceremonyPages) * (var(--vh) * 100));
      z-index: 1;
    }
    .ceremony-stage{
      position: sticky;
      top:0;
      height: calc(var(--vh) * 100);
      display:grid;
      place-items:center;
      overflow:hidden;
      isolation: isolate;
    }

    .ceremony-stage::after{
      content:"";
      position:absolute;
      left:0; right:0; bottom:0;
      height: calc(var(--vh) * 24);
      background: linear-gradient(to bottom,
        rgba(0,0,0,0) 0%,
        rgba(0,0,0,.78) 55%,
        rgba(0,0,0,1) 100%);
      pointer-events:none;
      z-index: 2;
    }

    .ceremony-inner{
      width: min(var(--stageMax), calc(100vw - var(--stagePad)));
      height:100%;
      position:relative;
      display:grid;
      place-items:center;
      z-index: 3;
    }

    .line{
      position:absolute;
      left:50%;
      transform: translate3d(-50%,0,0);
      text-align:center;

      font-size: var(--textSize);
      line-height: 1.24;
      letter-spacing: .01em;
      font-weight: 400;

      white-space: nowrap;
      max-width:none;

      color: rgba(255,255,255,.90);
      text-shadow:
        0 0 2px rgba(255,255,255,.22),
        0 0 14px rgba(200,220,255,.12),
        0 0 26px rgba(180,200,255,.05);

      opacity: 0;
      filter: blur(1.2px);

      transition: none;
      will-change: opacity, filter, transform;

      -webkit-font-smoothing: antialiased;
      text-rendering: geometricPrecision;
      backface-visibility: hidden;
      transform-style: preserve-3d;

      pointer-events:none;
      z-index: 3;
    }

    .s1{ top: 18%; }
    .s2{ top: 34%; }
    .s3{ top: 54%; }
    .s4{ top: 70%; }

    /* MOBILE: 3 breaks, centered, stable sizing */
    @media (max-width: 540px){
      #l1{
        left: 50%;
        width: 92vw;
        transform: translate3d(-50%,0,0);
        text-align: center;

        white-space: normal;
        max-width: 92vw;

        font-size: clamp(20px, 5.8vw, 28px);
        line-height: 1.18;
        letter-spacing: .006em;
      }

      #l1 .l1-wrap{
        display: flex;
        flex-direction: column;
        align-items: center;
        width: 100%;
        transform: scale(var(--l1Scale, 1));
        transform-origin: center center;
        will-change: transform;
      }

      #l1 .l1-line{
        display: block;
        width: fit-content;
        white-space: nowrap;
      }

      #l1 .l1-emph{ font-weight: 500; }
    }

    .enter{
      position:absolute;
      left:50%;
      bottom: calc(var(--vh) * 8);
      transform: translate3d(-50%,0,0);
      background: none;
      border: none;
      padding: 0;

      font-size: 15px;
      letter-spacing: .22em;
      text-transform: lowercase;
      font-weight: 400;

      color: rgba(255,255,255,.85);
      text-shadow:
        0 0 8px rgba(220,235,255,.18),
        0 0 22px rgba(200,220,255,.12);

      cursor: pointer;
      user-select:none;

      opacity: 0;
      transition: opacity 400ms ease;
      z-index: 6;
    }
    .enter:hover{ opacity: 1; }
    .enter:focus{ outline: none; }
  </style>
</head>

<body>
  <div class="mist" id="mist" aria-hidden="true"></div>
  <canvas id="ocean" aria-hidden="true"></canvas>

  <section class="portal" id="portal">
    <div class="portal-stage">
      <div class="portal-inner">
        <img id="hero" src="new_portal.jpeg" alt="">
        <div class="invocation" id="invocation">BLANKET ME</div>
      </div>
    </div>
  </section>

  <section class="ceremony" id="ceremony">
    <div class="ceremony-stage">
      <div class="ceremony-inner">

        <div class="line s1" id="l1">
          <div class="l1-wrap" id="l1wrap">
            <span class="l1-line">we imagine in this exhibition</span>
            <span class="l1-line">an invitation to witness our creation</span>
            <span class="l1-line">of new ways of experiencing</span>
            <span class="l1-line l1-emph">boundless love</span>
          </div>
        </div>

        <div class="line s2" id="l2">forward-facing and fusing ethereality with inspiration</div>
        <div class="line s3" id="l3">we bear witness and release limitation</div>
        <div class="line s4" id="l4">opening to transformation</div>

        <button class="enter" id="enter" type="button">enter</button>
      </div>
    </div>
  </section>

  <script>
    // --- iOS Safari viewport-height stabilizer (fixes sticky+scroll jitter) ---
    let LOCKED_VH = window.innerHeight;

    function setVhVar(){
      LOCKED_VH = window.innerHeight;
      document.documentElement.style.setProperty("--vh", (LOCKED_VH * 0.01) + "px");
    }

    setVhVar();
    window.addEventListener("resize", setVhVar, { passive:true });
    window.addEventListener("orientationchange", () => setTimeout(setVhVar, 150), { passive:true });

    const ocean = document.getElementById("ocean");
    const ctx = ocean.getContext("2d", { alpha: true });
    const mistEl = document.getElementById("mist");

    let W=0, H=0, DPR=1;
    let drops = [];
    let beads = [];

    function resizeOcean(){
      DPR = Math.min(2, window.devicePixelRatio || 1);
      W = window.innerWidth;
      H = LOCKED_VH;

      ocean.width = Math.floor(W * DPR);
      ocean.height = Math.floor(H * DPR);
      ocean.style.width = W + "px";
      ocean.style.height = H + "px";
      ctx.setTransform(DPR,0,0,DPR,0,0);

      const n = Math.max(240, Math.min(620, Math.floor((W*H)/9000)));
      drops = Array.from({length:n}, () => newDrop(true));

      const b = Math.max(22, Math.min(52, Math.floor(W/26)));
      beads = Array.from({length:b}, () => newBead());
    }

    function newDrop(randomY){
      const tiny = Math.random() < 0.82;
      return {
        x: Math.random() * W,
        y: randomY ? Math.random() * H : (-50 - Math.random()*H),
        len: tiny ? (10 + Math.random()*26) : (22 + Math.random()*42),
        spd: tiny ? (1.6 + Math.random()*3.2) : (1.2 + Math.random()*2.4),
        w:   tiny ? (0.6 + Math.random()*0.9) : (0.8 + Math.random()*1.2),
        a:   tiny ? (0.028 + Math.random()*0.060) : (0.020 + Math.random()*0.050),
        drift:(-0.25 + Math.random()*0.50)
      };
    }

    function newBead(){
      return {
        x: Math.random()*W,
        y: Math.random()*H,
        r: 1.2 + Math.random()*2.8,
        vy: 0.05 + Math.random()*0.22,
        vx: (-0.06 + Math.random()*0.12),
        a: 0.05 + Math.random()*0.12
      };
    }

    function drawOcean(rainBoost=1){
      ctx.clearRect(0,0,W,H);
      ctx.globalCompositeOperation = "source-over";

      for (const d of drops){
        d.y += d.spd * rainBoost;
        d.x += d.drift * 0.15;

        if (d.y - d.len > H){
          d.y = -d.len - 10 - Math.random()*80;
          d.x = Math.random() * W;
        }
        if (d.x < -40) d.x = W + 40;
        if (d.x > W + 40) d.x = -40;

        const g = ctx.createLinearGradient(d.x, d.y, d.x, d.y + d.len);
        g.addColorStop(0,   `rgba(255,255,255,0)`);
        g.addColorStop(0.55,`rgba(235,242,255,${d.a})`);
        g.addColorStop(1,   `rgba(255,255,255,0)`);

        ctx.strokeStyle = g;
        ctx.lineWidth = d.w;
        ctx.lineCap = "round";

        ctx.beginPath();
        ctx.moveTo(d.x, d.y);
        ctx.lineTo(d.x, d.y + d.len);
        ctx.stroke();
      }

      for (const b of beads){
        b.y += b.vy * rainBoost;
        b.x += b.vx;

        b.vx += (-0.004 + Math.random()*0.008);
        b.vx = Math.max(-0.10, Math.min(0.10, b.vx));

        if (b.y > H + 20){
          b.y = -20 - Math.random()*80;
          b.x = Math.random()*W;
          b.r = 1.2 + Math.random()*2.8;
          b.vy = 0.05 + Math.random()*0.22;
        }

        ctx.fillStyle = `rgba(255,255,255,${b.a})`;
        ctx.beginPath();
        ctx.arc(b.x, b.y, b.r, 0, Math.PI*2);
        ctx.fill();
      }
    }

    function loop(){
      drawOcean(window.__rainBoost || 1);
      requestAnimationFrame(loop);
    }

    resizeOcean();
    loop();

    const hero = document.getElementById("hero");
    const portal = document.getElementById("portal");
    const ceremony = document.getElementById("ceremony");

    const l1 = document.getElementById("l1");
    const l1wrap = document.getElementById("l1wrap");

    const lines = [
      l1,
      document.getElementById("l2"),
      document.getElementById("l3"),
      document.getElementById("l4"),
    ];
    const enter = document.getElementById("enter");

    function smoothstep(x){
      x = Math.min(1, Math.max(0, x));
      return x*x*(3 - 2*x);
    }

    function fitLine(el, maxVW = 0.92, minScale = 0.72){
      if (!el) return;
      el.style.transform = "translate3d(-50%,0,0) scale(1)";
      const maxW = Math.min(window.innerWidth * maxVW, 1200);
      const w = el.scrollWidth;
      if (w > maxW){
        const s = Math.max(minScale, Math.min(1, maxW / w));
        el.style.transform = `translate3d(-50%,0,0) scale(${s.toFixed(3)})`;
      }
    }

    function fitL1Mobile(){
      if (!l1 || !l1wrap) return;
      if (window.innerWidth > 540) {
        l1.style.removeProperty("--l1Scale");
        return;
      }
      const maxW = window.innerWidth * 0.92;
      const lineEls = l1wrap.querySelectorAll(".l1-line");
      let widest = 0;
      lineEls.forEach(el => { widest = Math.max(widest, el.scrollWidth); });
      const s = widest > 0 ? Math.min(1, maxW / widest) : 1;
      const clamped = Math.max(0.78, s);
      l1.style.setProperty("--l1Scale", clamped.toFixed(3));
    }

    function fitLines(){
      const isMobile = window.innerWidth <= 540;

      if (!isMobile){
        fitLine(lines[0], 0.92, 0.85);
        fitLine(lines[1], 0.92, 0.85);
        fitLine(lines[2], 0.92, 0.85);
        fitLine(lines[3], 0.92, 0.85);
      } else {
        fitL1Mobile();
        fitLine(lines[1], 0.92, 0.75);
        fitLine(lines[2], 0.92, 0.75);
        fitLine(lines[3], 0.92, 0.75);
      }
    }

    function portalScroll(){
      const rect = portal.getBoundingClientRect();
      const vh = LOCKED_VH;
      const total = rect.height - vh;
      const p = Math.min(1, Math.max(0, (-rect.top) / (total || 1)));

      const driftPx = vh * 0.28;
      const y = (0.5 - p) * 2 * driftPx;
      hero.style.setProperty("--y", `${y}px`);
      /* ticker stays fixed at opacity 1, no JS fade */
    }

    function ceremonyScroll(){
      const rect = ceremony.getBoundingClientRect();
      const vh = LOCKED_VH;
      const total = rect.height - vh;
      const p = Math.min(1, Math.max(0, (-rect.top) / (total || 1)));

      const rainIn = smoothstep((p - 0.05) / 0.35);

      const rainMax = parseFloat(getComputedStyle(document.documentElement).getPropertyValue("--rainOpacityMax")) || 0.50;
      const mistMax = parseFloat(getComputedStyle(document.documentElement).getPropertyValue("--mistOpacityMax")) || 0.55;

      const rainOpacity = (rainIn <= 0.001) ? 0 : (0.18 + rainIn * rainMax);
      ocean.style.opacity = rainOpacity.toFixed(3);
      window.__rainBoost = 1 + rainIn * 1.35;

      const mistOpacity = (rainIn <= 0.001) ? 0 : (0.10 + rainIn * mistMax);
      mistEl.style.opacity = Math.min(0.85, mistOpacity).toFixed(3);

      const n = lines.length;
      const seg = 1 / (n + 1.35);
      const inStart = 0.16;
      const outStart = 0.56;

      for (let i=0; i<n; i++){
        const start = i * seg;
        const local = (p - start) / (seg || 1);

        let alpha = 0;

        if (local >= inStart && local <= outStart){
          const tIn = (local - inStart) / (outStart - inStart);
          alpha = smoothstep(tIn);
        }
        if (local > outStart){
          const tOut = (local - outStart) / (1 - outStart);
          alpha = 1 - smoothstep(tOut);
        }

        alpha = Math.max(0, Math.min(1, alpha));
        lines[i].style.opacity = alpha.toFixed(3);
        lines[i].style.filter = `blur(${(1.2 * (1 - alpha)).toFixed(2)}px)`;
      }

      const enterStart = (n * seg) + 0.08;
      const enterAlpha = smoothstep((p - enterStart) / 0.18);
      enter.style.opacity = enterAlpha.toFixed(3);

      fitLines();

      if (p > 0.985){
        lines.forEach(l => {
          l.style.opacity = "0";
          l.style.filter = "blur(1.2px)";
        });
        enter.style.opacity = "1";
      }
    }

    function onScroll(){
      portalScroll();
      ceremonyScroll();
    }

    window.addEventListener("scroll", onScroll, { passive:true });
    window.addEventListener("resize", () => { setVhVar(); resizeOcean(); fitLines(); }, { passive:true });
    window.addEventListener("load", () => { setVhVar(); resizeOcean(); fitLines(); onScroll(); });

    fitLines();
    onScroll();

    enter.addEventListener("click", () => {
      window.location.href = "interior.html";
    });
  </script>
</body>
</html>
